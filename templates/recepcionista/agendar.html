{% extends "base.html" %}

{% block title %}Agendar Exame{% endblock %}

{% block navigation %}
<ul>
    <li><a href="{{ url_for('dashboard_recepcionista') }}">Dashboard</a></li>
    <li><a href="{{ url_for('agendar_exame_recepcionista') }}">Novo Agendamento</a></li>
    <li><a href="{{ url_for('logout') }}">Sair</a></li>
</ul>
{% endblock %}

{% block content %}
<h2>Agendar Novo Exame</h2>

{% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for message in messages %}
            <p><strong>{{ message }}</strong></p>
        {% endfor %}
    {% endif %}
{% endwith %}

<form method="POST">
    <p>
        <label>Paciente:</label><br>
        <select name="paciente_id" required>
            <option value="">Selecione o paciente...</option>
            {% for paciente in pacientes %}
                <option value="{{ paciente.id }}">{{ paciente.nome }} - CPF: {{ paciente.cpf }}</option>
            {% endfor %}
        </select>
    </p>
    
    <p>
        <label>Tipo de Exame:</label><br>
        <select name="tipo_exame" required>
            <option value="">Selecione o tipo de exame...</option>
            <option value="Hemograma">Hemograma</option>
            <option value="Glicemia">Glicemia</option>
            <option value="Colesterol">Colesterol</option>
            <option value="Triglicerídeos">Triglicerídeos</option>
            <option value="Ureia">Ureia</option>
            <option value="Creatinina">Creatinina</option>
        </select>
    </p>
    
    <p>
        <label>Data e Hora:</label><br>
        <input type="datetime-local" name="data_hora" required
               min="{{ now.strftime('%Y-%m-%dT%H:%M') }}"
               onchange="validarHorario(this)">
    </p>
    
    <button type="submit">Agendar Exame</button>
</form>

<script>
function validarHorario(input) {
    const data = new Date(input.value);
    const hora = data.getHours();
    
    if (hora < 8 || hora >= 18) {
        alert('Por favor, selecione um horário entre 8:00 e 18:00');
        input.value = '';
    }
}
</script>
{% endblock %} 